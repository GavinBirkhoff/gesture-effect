!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t(require("react")):"function"==typeof define&&define.amd?define(["react"],t):(e=e||self).VirtualList=t(e.React)}(this,function(e){"use strict";var o="default"in e?e.default:e,n=function(e,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)};var i=function(){return(i=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var o in t=arguments[n])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e}).apply(this,arguments)};function a(){for(var e=0,t=0,n=arguments.length;t<n;t++)e+=arguments[t].length;for(var r=Array(e),o=0,t=0;t<n;t++)for(var i=arguments[t],a=0,u=i.length;a<u;a++,o++)r[o]=i[a];return r}var p=1,d=2,S=4,m=8,b=16,u=d|S,s=m|b,c=u|s,t=251,f={threshold:10,velocity:.3};function y(e,t){return Math.sqrt(e*e+t*t)}function E(e,t){var n=Math.atan2(t,e);return 180/(Math.PI/n)}function P(){return Date.now()}function G(e){if(!(e.length<2)){var t=e[0],n=t.x,r=t.y,o=e[1],i=o.x-n,a=o.y-r;return{x:i,y:a,z:y(i,a),angle:E(i,a)}}}function l(e,t){return e+t[0].toUpperCase()+t.slice(1)}function C(e){var t;switch(e){case p:break;case d:t="left";break;case S:t="right";break;case m:t="up";break;case b:t="down"}return t}var r,g,h,v={all:c,vertical:s,horizontal:u};function T(){this.constructor=g}function M(e){var T=r.call(this,e)||this;return T.state={},T.triggerEvent=function(e){for(var t=[],n=1;n<arguments.length;n++)t[n-1]=arguments[n];var r=T.props[e];"function"==typeof r&&r.apply(void 0,a([T.getGestureState()],t))},T.triggerCombineEvent=function(e,t){for(var n=[],r=2;r<arguments.length;r++)n[r-2]=arguments[r];T.triggerEvent.apply(T,a([e],n)),T.triggerSubEvent.apply(T,a([e,t],n))},T.triggerSubEvent=function(e,t){for(var n,r=[],o=2;o<arguments.length;o++)r[o-2]=arguments[o];t&&(n=l(e,t),T.triggerEvent.apply(T,a([n],r)))},T.triggerPinchEvent=function(e,t){for(var n=[],r=2;r<arguments.length;r++)n[r-2]=arguments[r];var o=T.gesture.scale;"move"===t&&"number"==typeof o&&(1<o&&T.triggerEvent("onPinchOut"),o<1&&T.triggerEvent("onPinchIn")),T.triggerCombineEvent.apply(T,a([e,t],n))},T.initPressTimer=function(){T.cleanPressTimer(),T.pressTimer=setTimeout(function(){T.setGestureState({press:!0}),T.triggerEvent("onPress")},t)},T.cleanPressTimer=function(){T.pressTimer&&clearTimeout(T.pressTimer)},T.setGestureState=function(e){T.gesture||(T.gesture={}),T.gesture.touches&&(T.gesture.preTouches=T.gesture.touches),T.gesture=i(i({},T.gesture),e)},T.getGestureState=function(){return T.gesture?i({},T.gesture):T.gesture},T.cleanGestureState=function(){delete T.gesture},T.getTouches=function(e){return Array.prototype.slice.call(e.touches).map(function(e){return{x:e.screenX,y:e.screenY}})},T.triggerUserCb=function(e,t){var n=l("onTouch",e);n in T.props&&T.props[n](t)},T._handleTouchStart=function(e){T.triggerUserCb("start",e),1<(T.event=e).touches.length&&e.preventDefault(),T.initGestureStatus(e),T.initPressTimer(),T.checkIfMultiTouchStart()},T.initGestureStatus=function(e){T.cleanGestureState();var t=T.getTouches(e),n=P(),r=G(t);T.setGestureState({startTime:n,startTouches:t,startMutliFingerStatus:r,time:n,touches:t,mutliFingerStatus:r,srcEvent:T.event})},T.checkIfMultiTouchStart=function(){var e,t=T.props,n=t.enablePinch,r=t.enableRotate,o=T.gesture.touches;1<o.length&&(n||r)&&(n&&(e=G(o),T.setGestureState({startMutliFingerStatus:e,pinch:!0,scale:1}),T.triggerCombineEvent("onPinch","start")),r&&(T.setGestureState({rotate:!0,rotation:0}),T.triggerCombineEvent("onRotate","start")))},T._handleTouchMove=function(e){T.triggerUserCb("move",e),T.event=e,T.gesture&&(T.cleanPressTimer(),T.updateGestureStatus(e),T.checkIfSingleTouchMove(),T.checkIfMultiTouchMove())},T.checkIfMultiTouchMove=function(){var e,t,n,r,o=T.gesture,i=o.pinch,a=o.rotate,u=o.touches,s=o.startMutliFingerStatus,c=o.mutliFingerStatus;if(i||a){if(u.length<2)return T.setGestureState({pinch:!1,rotate:!1}),i&&T.triggerCombineEvent("onPinch","cancel"),void(a&&T.triggerCombineEvent("onRotate","cancel"));i&&(e=c.z/s.z,T.setGestureState({scale:e}),T.triggerPinchEvent("onPinch","move")),a&&(n=c,r=s.angle,t=n.angle-r,T.setGestureState({rotation:t}),T.triggerCombineEvent("onRotate","move"))}},T.allowGesture=function(){return e=T.gesture.direction,!!(T.directionSetting&e);var e},T.checkIfSingleTouchMove=function(){var e,t,n,r,o,i,a=T.gesture,u=a.pan,s=a.touches,c=a.moveStatus,l=a.preTouches,g=a.availablePan,h=void 0===g||g;if(1<s.length)return T.setGestureState({pan:!1}),void(u&&T.triggerCombineEvent("onPan","cancel"));if(c&&h){var v=(e=l[0],t=s[0],n=e.x,r=e.y,o=t.x-n,i=t.y-r,0==o&&0==i?p:Math.abs(o)>=Math.abs(i)?o<0?d:S:i<0?m:b);T.setGestureState({direction:v});var f=C(v);if(!T.allowGesture())return void(u||T.setGestureState({availablePan:!1}));u?(T.triggerCombineEvent("onPan",f),T.triggerSubEvent("onPan","move")):(T.triggerCombineEvent("onPan","start"),T.setGestureState({pan:!0,availablePan:!0}))}},T.checkIfMultiTouchEnd=function(e){var t=T.gesture,n=t.pinch,r=t.rotate;n&&T.triggerCombineEvent("onPinch",e),r&&T.triggerCombineEvent("onRotate",e)},T.updateGestureStatus=function(e){var t,n,r,o,i,a,u,s,c,l,g,h,v,f,p,d,S,m=P();T.setGestureState({time:m}),e.touches&&e.touches.length&&(n=(t=T.gesture).startTime,r=t.startTouches,o=t.pinch,i=t.rotate,a=T.getTouches(e),s=a,c=m-n,l=r[0],g=l.x,h=l.y,v=s[0],f=v.x-g,p=v.y-h,d=y(f,p),u={x:f,y:p,z:d,time:c,velocity:d/c,angle:E(f,p)},(o||i)&&(S=G(a)),T.setGestureState({touches:a,mutliFingerStatus:S,moveStatus:u}))},T._handleTouchEnd=function(e){T.triggerUserCb("end",e),T.event=e,T.gesture&&(T.cleanPressTimer(),T.updateGestureStatus(e),T.doSingleTouchEnd("end"),T.checkIfMultiTouchEnd("end"))},T._handleTouchCancel=function(e){T.triggerUserCb("cancel",e),T.event=e,T.gesture&&(T.cleanPressTimer(),T.updateGestureStatus(e),T.doSingleTouchEnd("cancel"),T.checkIfMultiTouchEnd("cancel"))},T.triggerAllowEvent=function(e,t){T.allowGesture()?T.triggerCombineEvent(e,t):T.triggerSubEvent(e,t)},T.doSingleTouchEnd=function(e){var t,n,r=T.gesture,o=r.moveStatus,i=r.pinch,a=r.rotate,u=r.press,s=r.pan,c=r.direction;if(!i&&!a){if(o){var l=o.z,g=o.velocity,h=(t=l,n=g,Math.abs(t)>=f.threshold&&Math.abs(n)>f.velocity);if(T.setGestureState({swipe:h}),s&&T.triggerAllowEvent("onPan",e),h){var v=C(c);return void T.triggerAllowEvent("onSwipe",v)}}u?T.triggerEvent("onPressUp"):T.triggerEvent("onTap")}},T.getTouchAction=function(){var e=T.props,t=e.enablePinch,n=e.enableRotate,r=T.directionSetting;return t||n||r===c?"pan-x pan-y":r===s?"pan-x":r===u?"pan-y":"auto"},T.directionSetting=v[e.direction],T}return r=e.Component,n(g=M,h=r),g.prototype=null===h?Object.create(h):(T.prototype=h.prototype,new T),M.prototype.componentWillUnmount=function(){this.cleanPressTimer()},M.prototype.render=function(){var e=this.props.children,t=o.Children.only(e),n=this.getTouchAction(),r={onTouchStart:this._handleTouchStart,onTouchMove:this._handleTouchMove,onTouchCancel:this._handleTouchCancel,onTouchEnd:this._handleTouchEnd};return o.cloneElement(t,i(i({},r),{style:i({touchAction:n},t.props.style||{})}))},M.defaultProps={enableRotate:!1,enablePinch:!1,direction:"all"},M});
